# 概要

ASTINAのエアコン制御用プログラム

28度以上でエアコンを起動

27度以下でエアコンを終了

- aircond.py  : 温度で処理内容を判断するプログラム
- cgir.py　　 : pigpioを使って赤外線の送受信、データ解析をするモジュール
- cgirtool.py : 赤外線送受信、データ解析をコマンドラインから使用できるようにしたツール

温度センサAM2320からI2C通信を用いて温度を取得。温度に応じてsubprocessからエアコンのon/offコマンドを実行。


# 使い方

## ■ 準備物

- マイコンボード：Raspberry Pi 3 modelB
- SDカード
- 電源コード
- 赤外線受信センサー：RPZ-IR-Sensor
- 温度センサー：AM2320
- ジャンパーワイヤー
- ブレッドボード ミニ
- ご家庭のエアコンとリモコン

## ■ エアコンの登録方法

### ・赤外線コードの登録

作成したディレクトリに移動し、コマンドを入力しEnterで実行

```
$ ./cgirtool.py rec 登録するデバイスの名前
```

下記が表示されたら、赤外線に向かってリモコンの起動ボタンを押す

```
$ 赤外線コード"登録するデバイスの名前"を受信中...
```


### ・赤外線コードの送信

エアコンへ向かって先程登録したデバイスの赤外線コードを送信

```
$ ./cgirtool.py send 登録したデバイスの名前
```

### ・ターミナルに温度情報を表示させる

ターミナルで以下のコマンドを実行

```
$ python3 aircond.py
```

## ■ 制御が成功した場合

`aircond.py`内の 37行目に記載している温度になったらエアコンが自動的に起動します。

その後、46行目 に記載している温度になったらエアコンが自動的に停止します。

## ■ 起動しない場合

- pigpioのクロックソースがPCMの場合、意図した38kHzの周波数にならず送信に失敗するようです。

`/lib/systemd/system/pigpiod.service` ファイルを開き、ExecStart行の最後に「-t 0」を追加してください。

```
ExecStart=/usr/bin/pigpio -l -t 0
```

- Raspberry Piと距離が離れていると実行されない場合があります。
自身の場合、エアコンから1.5m程離れてから実行すると正しく反応しました。

# その他

I2Cのセットアップが完了していない場合は以下のコマンドでI2Cを有効化してください。
```
$ sudo raspi-config nonint do_i2c 0
$ reboot
```



